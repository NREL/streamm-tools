<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>opvSQL &mdash; STREAMM-Tools 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="STREAMM-Tools 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
  
<a href="../index.html"><img src="../_static/logo.png" border="0" alt="sampledoc"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for opvSQL</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">getopt</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">decimal</span><span class="o">,</span> <span class="nn">random</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: psycopg2 module (SQL query) not found, check PYTHONPATH or install from source&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: numpy module not found, check PYTHONPATH for numpy install or module version&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib.mlab</span> <span class="kn">as</span> <span class="nn">ml</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: matplotlib.pyplot, ml module not found, check PYTHONPATH or install from source&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: mpl_toolkits.mplot3d module not found, check PYTHONPATH or install from source&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
    <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: sklearn.cluster module (density clustering) not found, check PYTHONPATH or install from source&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">runjobs</span> <span class="kn">import</span> <span class="n">Geometry</span><span class="p">,</span> <span class="n">IO</span><span class="p">,</span> <span class="n">Histogram1D</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;runjobs module not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Try adding the following to your .bashrc file&quot;</span>
    <span class="k">print</span> <span class="s">&quot;   PYTHONPATH=&#39;path-to-runjobs.py&#39;:$PYTHONPATH&#39;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;   export PYTHONPATH&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>


<div class="viewcode-block" id="OPVSqlBase"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase">[docs]</a><span class="k">class</span> <span class="nc">OPVSqlBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for managing data and opv SQL database attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pswd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor: Opens connection to SQL database and</span>
<span class="sd">        creates the &#39;cursor&#39; object to the SQL database</span>

<span class="sd">        Args:</span>
<span class="sd">            user (str) user name on Kestrel</span>
<span class="sd">            pswd (str) password for user for Kestrel database access</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hostStr</span>     <span class="o">=</span> <span class="s">&quot;host=kestrel.hpc.nrel.gov &quot;</span>
        <span class="n">dbportStr</span>   <span class="o">=</span> <span class="s">&quot;dbname=opv port=5432 &quot;</span>
        <span class="n">userPassStr</span> <span class="o">=</span> <span class="s">&quot;user=&quot;</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s">&quot; password=&quot;</span> <span class="o">+</span> <span class="n">pswd</span>
        <span class="n">statusStr</span>   <span class="o">=</span> <span class="s">&quot;user=&quot;</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s">&quot; password=XXXXXX&quot;</span>
        <span class="n">connStr</span>     <span class="o">=</span> <span class="n">hostStr</span> <span class="o">+</span> <span class="n">dbportStr</span> <span class="o">+</span> <span class="n">userPassStr</span>

        <span class="c"># get the current timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot; &quot;</span>
        <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;: Starting OPV database query. </span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="c"># Connect to the opv database</span>
        <span class="k">print</span> <span class="s">&quot;Starting database with &quot;</span><span class="p">,</span> <span class="n">hostStr</span> <span class="o">+</span> <span class="n">dbportStr</span> <span class="o">+</span> <span class="n">statusStr</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connStr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Database connection failed, check&quot;</span>
            <span class="k">print</span> <span class="s">&quot;  1. psycopg2 module path/version&quot;</span>
            <span class="k">print</span> <span class="s">&quot;  2. Check username and password for Kestrel&quot;</span>
            <span class="k">print</span> <span class="s">&quot;  3. Check status of Kestrel... is it up? </span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># Comma separated string for &#39;select&#39; keyword</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectStr</span><span class="o">=</span><span class="s">&quot;tag&quot;</span>


<div class="viewcode-block" id="OPVSqlBase.setSelectStr"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.setSelectStr">[docs]</a>    <span class="k">def</span> <span class="nf">setSelectStr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set/reset select string. This is a comma separated string that follows</span>
<span class="sd">        the &#39;select&#39; keyword for SQL queries</span>
<span class="sd">        (eg &quot;homo_extrapolated,gap_extrapolated,lumo_extrapolated&quot;)</span>

<span class="sd">        Args:</span>
<span class="sd">            s (str): comma separated &#39;select&#39; string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectStr</span> <span class="o">=</span> <span class="n">s</span>

</div>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor: cleaning up database object and print status info</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Close communication with the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;************************************************************&quot;</span>
        <span class="k">print</span> <span class="s">&quot;OPVSqlBase object destructor called:                        &quot;</span>
        <span class="k">print</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; : Complete OPV database query.             &quot;</span>
        <span class="k">print</span> <span class="s">&quot;************************************************************</span><span class="se">\n</span><span class="s">&quot;</span>



    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print help info and database fields available for searching</span>

<span class="sd">        FOR MORE INFO ON OTHER POSTGRES ARRAY OPERATORS AND FUNCTIONS GO HERE:</span>
<span class="sd">        http://www.postgresql.org/docs/9.1/static/functions-array.html</span>

<span class="sd">        FOR MORE INFO ON USING PSYOPG CURSORS GO HERE:</span>
<span class="sd">        http://initd.org/psycopg/docs/cursor.html</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">helpStr</span> <span class="o">=</span> <span class="s">&quot;There are two main tables:&quot;</span>
        <span class="n">helpStr</span> <span class="o">+=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        vw_oligomer</span>
<span class="s">        vw_structure</span>
<span class="s">        that contain these columns:</span>

<span class="s">        vw_oligomer:</span>
<span class="s">                     Column             |            Type             | Modifiers </span>
<span class="s">	#-------------------------------+-----------------------------+-----------</span>
<span class="s">	# project_id                    | integer                     | </span>
<span class="s">	# project_name                  | character varying(150)      | </span>
<span class="s">	# oligomer_id                   | integer                     | </span>
<span class="s">	# tag                           | character varying(150)      | </span>
<span class="s">        # oligomer_number               | integer</span>
<span class="s">	# backbone_type_name            | character varying           | </span>
<span class="s">	# molecule_type                 | character varying(150)      | </span>
<span class="s">	# bblock_list                   | character varying[]         | </span>
<span class="s">	# isomer_type                   | character varying(10)       | </span>
<span class="s">	# conformer_type                | character varying(10)       | </span>
<span class="s">	# oligomer_created_on           | timestamp without time zone | </span>
<span class="s">	# oligomer_result_id            | integer                     | </span>
<span class="s">	# basis                         | character varying(150)      | </span>
<span class="s">	# oligomer_result_date_added    | timestamp without time zone | </span>
<span class="s">	# oligomer_result_created_on    | timestamp without time zone | </span>
<span class="s">	# date_calculation_finished     | timestamp without time zone | </span>
<span class="s">	# oligomer_result_last_updated  | timestamp without time zone | </span>
<span class="s">	# homo                          | numeric(45,20)              | </span>
<span class="s">	# lumo                          | numeric(45,20)              | </span>
<span class="s">	# optical_lumo                  | numeric(45,20)              | </span>
<span class="s">	# homo_contour                  | numeric(45,20)              | </span>
<span class="s">	# lumo_contour                  | numeric(45,20)              | </span>
<span class="s">	# gap                           | numeric(45,20)              | </span>
<span class="s">	# logp                          | numeric(45,20)              | </span>
<span class="s">	# mu_x                          | numeric(45,20)              | </span>
<span class="s">	# mu_y                          | numeric(45,20)              | </span>
<span class="s">	# mu_z                          | numeric(45,20)              | </span>
<span class="s">	# mu_tot                        | numeric(45,20)              | </span>
<span class="s">	# total_energy                  | numeric(45,20)              | </span>
<span class="s">	# mu2_x                         | numeric                     | </span>
<span class="s">	# mu2_y                         | numeric                     | </span>
<span class="s">	# mu2_z                         | numeric                     | </span>
<span class="s">	# mu2_tot                       | numeric                     | </span>
<span class="s">	# dipole_difference             | numeric                     | </span>
<span class="s">	# date_cation_calc_finished     | timestamp without time zone | </span>
<span class="s">	# vert_cat_en                   | numeric(45,20)              | </span>
<span class="s">	# neutral_reorganization_energy | numeric(45,20)              | </span>
<span class="s">	# cation_reorganization_energy  | numeric(45,20)              | </span>
<span class="s">	# vertical_ionization_energy    | numeric(45,20)              | </span>
<span class="s">	# adiabatic_ionization_energy   | numeric(45,20)              | </span>
<span class="s">	# relaxed_neut_en               | numeric(45,20)              | </span>
<span class="s">	# relaxed_cat_en                | numeric(45,20)              | </span>
<span class="s">	# mol                           | text                        | </span>

<span class="s">       vw_structure:</span>
<span class="s">                    Column            |            Type             | Modifiers</span>
<span class="s">        #-----------------------------+-----------------------------+-----------</span>
<span class="s">	# project_id                  | integer                     | </span>
<span class="s">	# project_name                | character varying(150)      | </span>
<span class="s">	# structure_id                | integer                     | </span>
<span class="s">	# tag                         | character varying(150)      | </span>
<span class="s">	# backbone_type_name          | character varying           | </span>
<span class="s">	# max_oligomer_number         | integer                     | </span>
<span class="s">	# isomer_type                 | character varying(10)       | </span>
<span class="s">	# conformer_type              | character varying(10)       | </span>
<span class="s">	# structure_created_on        | timestamp without time zone | </span>
<span class="s">	# structure_result_id         | integer                     | </span>
<span class="s">	# basis                       | character varying(150)      | </span>
<span class="s">	# structure_result_date_added | timestamp without time zone | </span>
<span class="s">	# structure_result_created_on | timestamp without time zone | </span>
<span class="s">	# delta_homo                  | numeric(45,20)              | </span>
<span class="s">	# delta_lumo                  | numeric(45,20)              | </span>
<span class="s">	# delta_optical_lumo          | numeric(45,20)              | </span>
<span class="s">	# homo_extrapolated           | numeric(45,20)              | </span>
<span class="s">	# lumo_extrapolated           | numeric(45,20)              | </span>
<span class="s">	# gap_extrapolated            | numeric(45,20)              | </span>
<span class="s">	# optical_lumo_extrapolated   | numeric(45,20)              | </span>
<span class="s">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">helpStr</span>


<div class="viewcode-block" id="OPVSqlBase.newResultsCount"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.newResultsCount">[docs]</a>    <span class="k">def</span> <span class="nf">newResultsCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numDays</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a count of the oligomers loaded within the last week,</span>
<span class="sd">        and store the count to a variable</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            numDays (int) Number of days to search for new results</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">execStr</span> <span class="o">=</span> <span class="s">&quot;select count(1) from opv.vw_oligomer where oligomer_created_on &gt; current_timestamp - interval &#39;&quot;</span>
        <span class="n">execStr</span> <span class="o">=</span> <span class="n">execStr</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">numDays</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; days&#39;&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select count(1) from opv.vw_oligomer where oligomer_created_on &gt; current_timestamp - interval &#39;7 days&#39;&quot;</span><span class="p">)</span>
        <span class="n">cntrecent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cntrecent</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;There have been &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cntrecent</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; new oligomers created in the last 7 days. </span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;There have been 0 new oligomers created in the last 7 days. </span><span class="se">\n</span><span class="s">&#39;</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.runSQLCmd"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.runSQLCmd">[docs]</a>    <span class="k">def</span> <span class="nf">runSQLCmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sqlCmd</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Submit SQL string to database and return results</span>
<span class="sd">        Print stats</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            sqlCmd  (str) : SQL command string</span>
<span class="sd">            verbose (bool): Flag for printing results to screen</span>

<span class="sd">        Returns:</span>
<span class="sd">            Converts results in cursor object to a list of lists.</span>
<span class="sd">            The outer list corresponds to lines of results as if command</span>
<span class="sd">            submitted directly to &#39;kestrel&#39; sql database. Number of elements</span>
<span class="sd">            in inner list depends on string command</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span> <span class="s">&quot; &quot;</span>
        <span class="k">print</span> <span class="s">&quot;Send sqlDataBase command: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sqlCmd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sqlCmd</span><span class="p">)</span>

        <span class="c"># &#39;record&#39; from iterator is a tuple.</span>
        <span class="n">resList</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="p">:</span>
            <span class="n">lineList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
            <span class="n">resList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineList</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">):</span>
                <span class="k">print</span> <span class="n">lineList</span>

        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Number of results &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">resList</span><span class="p">),</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="n">resList</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.getTotalResults"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.getTotalResults">[docs]</a>    <span class="k">def</span> <span class="nf">getTotalResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find total number of various kinds of entries</span>
<span class="sd">         1. Total number in &#39;oligomer&#39;</span>
<span class="sd">         2. Total number in &#39;structure&#39;</span>
<span class="sd">         3. ...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;select tag from opv.vw_oligomer&quot;</span>
        <span class="n">oligList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;select tag from opv.vw_structure&quot;</span>
        <span class="n">strucList</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot; &quot;</span>
        <span class="k">print</span> <span class="s">&quot;Total oligomer  results --&gt; &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">oligList</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Total structure results --&gt; &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">strucList</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot; &quot;</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;select tag,dipole_difference from opv.vw_oligomer where dipole_difference is not null&quot;</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Results have &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rList</span><span class="p">),</span> <span class="s">&quot; d(dipole) values </span><span class="se">\n</span><span class="s">&quot;</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.plotScatter"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.plotScatter">[docs]</a>    <span class="k">def</span> <span class="nf">plotScatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">nameStr</span><span class="p">,</span> <span class="n">cullPts</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take 3D scatter coords and coloring list</span>

<span class="sd">        Args:</span>
<span class="sd">            data  (tuple): 4 tuples of 3D coords and colors strings</span>
<span class="sd">            nameStr (str): File name string</span>
<span class="sd">            cullPts (int): Number of points to plot (for speed)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">col1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c"># Unpack data</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="c"># Make 3d scatter</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">&#39;3d&#39;</span><span class="p">)</span>

        <span class="n">col1</span> <span class="o">=</span> <span class="n">col1</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cullPts</span><span class="p">]</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">col2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cullPts</span><span class="p">]</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="n">col3</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cullPts</span><span class="p">]</span>        
        <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cullPts</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">col3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">fList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>      <span class="c"># Set x label</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">fList</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>      <span class="c"># Set y label</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>          <span class="c"># If z exists, set z-label</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">fList</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">distName</span> <span class="o">=</span> <span class="s">&quot;opvScatter_&quot;</span> <span class="o">+</span> <span class="n">nameStr</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Plotting &quot;</span><span class="p">,</span> <span class="n">distName</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">distName</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.plotContour"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.plotContour">[docs]</a>    <span class="k">def</span> <span class="nf">plotContour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">nameStr</span><span class="p">,</span> <span class="n">cullPts</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take 3D scatter coords and coloring list</span>

<span class="sd">        Args:</span>
<span class="sd">            data  (tuple): 4 tuples of 3D coords and colors strings</span>
<span class="sd">            nameStr (str): File name string</span>
<span class="sd">            cullPts (int): Number of points to plot (for speed)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">col1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c"># Unpack data</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="c"># Make 2d contour</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="n">col1</span> <span class="o">=</span> <span class="n">col1</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cullPts</span><span class="p">]</span> <span class="c"># homo  x</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">col2</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cullPts</span><span class="p">]</span> <span class="c"># gap    z</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="n">col3</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cullPts</span><span class="p">]</span> <span class="c"># lumo  y</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">col1</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">col3</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">col3</span><span class="p">)</span>

        <span class="c"># Reshape data for matplotlib contour calls</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
        <span class="n">zi</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col3</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

        <span class="c"># Make contour plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">linewidths</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">)</span>

        <span class="c"># Label plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s">&#39;rainbow&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span> 
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Simple contour plot&quot;</span><span class="p">)</span>

        <span class="c"># Output</span>
        <span class="n">distName</span> <span class="o">=</span> <span class="s">&quot;opvContour_&quot;</span> <span class="o">+</span> <span class="n">nameStr</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Plotting &quot;</span><span class="p">,</span> <span class="n">distName</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">distName</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.getBasisScatter"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.getBasisScatter">[docs]</a>    <span class="k">def</span> <span class="nf">getBasisScatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets structure results from db along with basis string and colors</span>

<span class="sd">        Args:</span>
<span class="sd">        Return: List of x,y,z, colors values suitable for scatter plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;tag,&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectStr</span> <span class="o">+</span> <span class="s">&quot;,basis &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;from opv.vw_structure&quot;</span>

        <span class="c"># Run command</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="c"># Analyze results</span>
        <span class="n">col0</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># tags</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 1</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 2</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 3</span>
        <span class="n">col4</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># basis string</span>

        <span class="n">colors</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">bStr</span> <span class="ow">in</span> <span class="n">col4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bStr</span> <span class="o">==</span> <span class="s">&quot;6-31g(d)&quot;</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">bStr</span> <span class="o">==</span> <span class="s">&quot;camb3lyp/6-31g&quot;</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">bStr</span> <span class="o">==</span> <span class="s">&quot;6-31g(d)//6-31+g(d)&quot;</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">bStr</span> <span class="o">==</span> <span class="s">&quot;camb3lyp/6-31g(d)&quot;</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">bStr</span> <span class="o">==</span> <span class="s">&quot;lc-wpbe/6-31+g(d)&quot;</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">col3</span><span class="p">,</span> <span class="n">colors</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dat</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.selectBasisData"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.selectBasisData">[docs]</a>    <span class="k">def</span> <span class="nf">selectBasisData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagSearch</span><span class="p">,</span> <span class="n">basisName</span><span class="o">=</span><span class="s">&#39;6-31g(d)&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets structure results from db along with basis string and colors</span>

<span class="sd">        Args:</span>
<span class="sd">            tagSearch (str): Power search string</span>
<span class="sd">            basisName (str): name of basis for calculation (default to standard b3lyp)</span>
<span class="sd">            </span>
<span class="sd">        Return: List of x,y,z, colors values suitable for scatter plot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">basisString</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">basisName</span> <span class="o">+</span> <span class="s">&quot;&#39; &quot;</span>
        <span class="n">powerString</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">tagSearch</span> <span class="o">+</span> <span class="s">&quot;\_%&#39; &quot;</span>
        <span class="k">print</span> <span class="s">&quot;basisString = &quot;</span><span class="p">,</span> <span class="n">basisString</span>
        <span class="k">print</span> <span class="s">&quot;powerString = &quot;</span><span class="p">,</span> <span class="n">powerString</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;tag,&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectStr</span> <span class="o">+</span> <span class="s">&quot;,basis &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;from opv.vw_structure where &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;tag like &quot;</span> <span class="o">+</span> <span class="n">powerString</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;and &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;basis=&quot;</span> <span class="o">+</span> <span class="n">basisString</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
        
        <span class="c"># Run command</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="c"># Analyze results</span>
        <span class="n">col0</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># tags</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 1</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 2</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 3</span>

        <span class="n">tmp1</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">tmp2</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">tmp3</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">tmpcolors</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">colors</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">col0</span><span class="p">:</span>

            <span class="k">if</span> <span class="s">&quot;A1_&quot;</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&quot;A2_&quot;</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&quot;A48_&quot;</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&quot;A5_&quot;</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&quot;A86_&quot;</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            
        <span class="c"># Removed &#39;uncolored&#39; results</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">color</span> <span class="o">!=</span> <span class="s">&#39;w&#39;</span><span class="p">:</span>
                <span class="n">tmp1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">tmp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">tmp3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">tmpcolors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                

        <span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp1</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">,</span> <span class="n">tmp3</span><span class="p">,</span> <span class="n">tmpcolors</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dat</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.plotHist"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.plotHist">[docs]</a>    <span class="k">def</span> <span class="nf">plotHist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">idstr</span><span class="p">,</span> <span class="n">xlab</span><span class="p">,</span> <span class="n">ylab</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze 1D-histogram </span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">            dat      (): result of histogram object</span>
<span class="sd">            idstr (str): middle string tag for output file</span>
<span class="sd">            xlab (str): x-axis label</span>
<span class="sd">            ylab (str): y-axis label</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Calc parameters for histograms</span>
        <span class="n">mintmp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
        <span class="n">maxtmp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">mintmp</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">0.01</span><span class="o">*</span><span class="n">mintmp</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">maxtmp</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">0.01</span><span class="o">*</span><span class="n">maxtmp</span><span class="p">)</span>
        <span class="n">numbins</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Histogram1D</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">numbins</span><span class="p">)</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">getHistogram</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>

        <span class="n">binVals</span>     <span class="o">=</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">avgHistVals</span> <span class="o">=</span> <span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># Hist data plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
        <span class="c">#plt.title(idstr)</span>

        <span class="c"># Output to image</span>
        <span class="n">distName</span> <span class="o">=</span> <span class="s">&quot;opvHist_&quot;</span> <span class="o">+</span> <span class="n">idstr</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Plotting &quot;</span><span class="p">,</span> <span class="n">distName</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">distName</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.runBasisStats"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.runBasisStats">[docs]</a>    <span class="k">def</span> <span class="nf">runBasisStats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get info about basis-s used for Gaussian calculations in database</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot;tag,basis &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot;from opv.vw_structure&quot;</span>

        <span class="c"># Run command</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="n">tagsL</span>  <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>
        <span class="n">basisL</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>

        <span class="k">print</span> <span class="s">&quot; &quot;</span>
        <span class="k">print</span> <span class="s">&quot;Number of tags              = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tagsL</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Number of different basis-s = &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">basisL</span><span class="p">))</span>
        <span class="k">print</span> <span class="s">&quot; &quot;</span>
        
        <span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">basisL</span><span class="p">):</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">basisL</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">num</span><span class="p">,</span> <span class="s">&quot; basis for &quot;</span><span class="p">,</span> <span class="n">basis</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.testCSV"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.testCSV">[docs]</a>    <span class="k">def</span> <span class="nf">testCSV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="s">&#39;foo.csv&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run SQL command and dump to CSV</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Create a CSV file consisting of the tag, oligomer number and the mol string of all oligomers</span>
        <span class="c"># created in the last 7 days with BBs A43, R8 and D1</span>
        <span class="c"># To do this, first open a file, then use the psycopg cursor copy_expert to specify a COPY</span>
        <span class="c"># command that uses a query.</span>
        <span class="c"># In the COPY command, use &quot;TO STDOUT&quot;, and then as the last param to copy_expert</span>
        <span class="c"># specify your python file. Don&#39;t forget to close the file when you&#39;re done.</span>
        <span class="c"># You can open this file in Excel.</span>
        <span class="c"># fo = open(&quot;foo.csv&quot;, &quot;w+&quot;)</span>
        <span class="c"># cur.copy_expert(&quot;COPY (select tag,oligomer_number,mol from opv.vw_oligomer</span>
        <span class="c">#    where bblock_list::text[] @&gt; ARRAY[&#39;A43&#39;,&#39;R8&#39;,&#39;D1&#39;]</span>
        <span class="c"># and oligomer_created_on &gt; current_timestamp - interval &#39;7 days&#39;) TO STDOUT WITH CSV HEADER&quot;,fo)</span>
        <span class="c"># fo.close()</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;tag,homo_extrapolated,gap_extrapolated,lumo_extrapolated &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;from opv.vw_structure where &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;basis=&#39;6-31g(d)&#39; and tag like &#39;D1\_%A48\_%&#39;&quot;</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&quot;w+&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">copy_expert</span><span class="p">(</span><span class="s">&quot;COPY ( &quot;</span> <span class="o">+</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot; ) TO STDOUT WITH CSV HEADER&quot;</span><span class="p">,</span><span class="n">fo</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">hdvisStr</span> <span class="o">=</span> <span class="s">&quot;/Users/ssides/hdvis3/build-hdvis3-Desktop_Qt_5_3_clang_64bit-Debug/hdvis3.app/Contents/MacOS/hdvis3 &quot;</span> <span class="o">+</span> <span class="n">fileName</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">hdvisStr</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.generateParallelCoordCSV"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.generateParallelCoordCSV">[docs]</a>    <span class="k">def</span> <span class="nf">generateParallelCoordCSV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchTags</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="s">&#39;foo.csv&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run SQL command and dump to CSV format. Creating a parallel coordinate file</span>
<span class="sd">        suitable for reading in hdvis3 application</span>

<span class="sd">        Args:</span>
<span class="sd">            searchTags (list) List of strings to insert as parallel coords</span>
<span class="sd">            fileName   (str)  Name of .csv file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">searchFieldStr</span> <span class="o">=</span> <span class="s">&quot;tag,homo_extrapolated,gap_extrapolated,lumo_extrapolated &quot;</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="n">searchFieldStr</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;from opv.vw_structure where &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;basis=&#39;6-31g(d)&#39; and tag like &#39;D2\_%&#39;&quot;</span>

        <span class="c"># Run SQL command </span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="n">fileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;w+&#39;</span><span class="p">)</span>             <span class="c"># Open CSV file</span>
        <span class="n">headerStrList</span> <span class="o">=</span> <span class="n">searchFieldStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>  <span class="c"># Initalize header line to search, add tag fields below</span>
        <span class="k">for</span> <span class="n">tagStr</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">searchTags</span><span class="p">):</span>        <span class="c"># Insert tag labels into CSV head line</span>
            <span class="n">headerStrList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tagStr</span><span class="p">)</span>        <span class="c"># right after &#39;tag&#39; search field</span>

        <span class="c"># Convert to header list to comma sep string</span>
        <span class="n">headerStr</span><span class="o">=</span><span class="n">headerStrList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">headerStrList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">headerStr</span> <span class="o">+=</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">st</span>

        <span class="c"># Write out CSV data</span>
        <span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">headerStr</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">datLine</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">:</span>
            <span class="n">csvLine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagCheckSQLDataLine</span><span class="p">(</span><span class="n">searchTags</span><span class="p">,</span> <span class="n">datLine</span><span class="p">)</span>
            <span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">csvLine</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fileObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">hdvisStr</span> <span class="o">=</span> <span class="s">&quot;/Users/ssides/hdvis3/build-hdvis3-Desktop_Qt_5_3_clang_64bit-Debug/hdvis3.app/Contents/MacOS/hdvis3 &quot;</span> <span class="o">+</span> <span class="n">fileName</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">hdvisStr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.tagCheckSQLDataLine"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.tagCheckSQLDataLine">[docs]</a>    <span class="k">def</span> <span class="nf">tagCheckSQLDataLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searchTags</span><span class="p">,</span> <span class="n">datLine</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze tag in data line and insert &#39;flags&#39; into line and convert to</span>
<span class="sd">        a comma separated string</span>

<span class="sd">        Args:</span>
<span class="sd">            searchTags (list) List of search strings tags eg [&quot;A1&quot;, &quot;A2&quot;, ...]</span>
<span class="sd">            datLine    (list) Input data [&quot;D1_R1R800_A48__&quot;,-5.454,1.663,-3.5519]</span>

<span class="sd">        Returns:</span>
<span class="sd">            Comma separated string (suitable for output to csv file)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">inputTag</span> <span class="o">=</span> <span class="n">datLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tagFoundList</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>

        <span class="c"># Setting tag flags</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">searchTags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">inputTag</span><span class="p">:</span>
               <span class="n">tagFoundList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">tagFoundList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># Insert tag flag list into input line</span>
        <span class="k">for</span> <span class="n">ifound</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tagFoundList</span><span class="p">):</span>
            <span class="n">datLine</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ifound</span><span class="p">)</span>
    
        <span class="c"># Convert to comma separated line</span>
        <span class="n">commaSepStr</span><span class="o">=</span><span class="n">datLine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idat</span> <span class="ow">in</span> <span class="n">datLine</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">commaSepStr</span> <span class="o">+=</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idat</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">commaSepStr</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.getMetaData"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.getMetaData">[docs]</a>    <span class="k">def</span> <span class="nf">getMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagStr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs select get_json_meta(tagStr,1)</span>
<span class="sd">        e.g. select get_json_meta(D1_R1R100_A1_R3R30000_,1)</span>
<span class="sd">        Takes metadata string and formats into a dictionary with</span>
<span class="sd">        blank values for nstates, basis, accuracy.</span>
<span class="sd">        Updates the timestamp in the metadata dictionary</span>

<span class="sd">        Args:</span>
<span class="sd">            tagStr (str): tag string in db eg D1_R1R100_A1_R3R30000_</span>
<span class="sd">        Returns:</span>
<span class="sd">            dictionary of metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">ast</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">datetime</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;opv.get_json_meta(&#39;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="n">tagStr</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;&#39;,1);&quot;</span>

        <span class="c"># Run command</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="n">dictStr</span> <span class="o">=</span> <span class="n">rList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dictObj</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">dictStr</span><span class="p">)</span>  <span class="c"># Convert string to dictionary</span>
        <span class="n">metaValDict</span> <span class="o">=</span> <span class="n">dictObj</span><span class="p">[</span><span class="s">&#39;metadata&#39;</span><span class="p">]</span>    <span class="c"># Take metadata &#39;values&#39; dict</span>

        <span class="c"># print dictObj</span>
        <span class="k">return</span> <span class="n">dictObj</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.splitFixedLine"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.splitFixedLine">[docs]</a>    <span class="k">def</span> <span class="nf">splitFixedLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split a string with fixed format given by &#39;cols&#39; into a list of strings</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            line  (str): input fixed format string</span>
<span class="sd">            cols (list): list of integers for position of end of each column</span>
<span class="sd">      </span>
<span class="sd">        Return:</span>
<span class="sd">            split list of columns strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="p">[</span> <span class="n">line</span><span class="p">[</span> <span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span> <span class="p">]</span>
        <span class="k">return</span> <span class="n">sep</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.molToSimObj"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.molToSimObj">[docs]</a>    <span class="k">def</span> <span class="nf">molToSimObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molEntry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a mol string in STREAMM database, parse information/parameters</span>
<span class="sd">        and return a StructureContainer with atom positions</span>

<span class="sd">        Args:</span>
<span class="sd">            molEntry (str): mol string</span>

<span class="sd">        Returns:</span>
<span class="sd">            3-tuple: (runName, basis, StructureContainer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">particles</span>           <span class="kn">import</span> <span class="n">Particle</span>
        <span class="kn">from</span> <span class="nn">particles</span>           <span class="kn">import</span> <span class="n">ParticleContainer</span>
        <span class="kn">from</span> <span class="nn">structureContainer</span>  <span class="kn">import</span> <span class="n">StructureContainer</span>
        <span class="kn">from</span> <span class="nn">simulationGaussian1</span> <span class="kn">import</span> <span class="n">SimulationGaussian1</span>

        <span class="n">topCols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">38</span><span class="p">]</span> <span class="c"># Fixed column format for top header line</span>
        <span class="n">botCols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">21</span><span class="p">]</span>                <span class="c"># Fixed column foramt for bond connect section</span>

        <span class="c"># Parse &#39;mol&#39; text string</span>
        <span class="n">tag</span>      <span class="o">=</span> <span class="n">molEntry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">basis</span>    <span class="o">=</span> <span class="n">molEntry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">molStr</span>   <span class="o">=</span> <span class="n">molEntry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">molStrLines</span> <span class="o">=</span> <span class="n">molStr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">runNameInfo</span>  <span class="o">=</span> <span class="n">molStrLines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>              <span class="c"># eg &#39;acc1_D1_R2R200_Sp2_00_A48__Sp2_00__n1 TD-DFT</span>
        <span class="n">runNameSplit</span> <span class="o">=</span> <span class="n">runNameInfo</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>         <span class="c"># eg [&#39;acc1_D1_R2R200_Sp2_00_A48__Sp2_00__n1, TD-DFT]</span>
        <span class="n">dbLabel</span>      <span class="o">=</span> <span class="n">molStrLines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>              <span class="c"># eg &#39;OpenBabel03111416503D&#39;</span>
        <span class="n">numElements</span>  <span class="o">=</span> <span class="n">molStrLines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>              <span class="c"># eg &#39;52 58 0 0....&#39;</span>

        <span class="c"># Parse fixed line part of mol string</span>
        <span class="n">splitLine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splitFixedLine</span><span class="p">(</span><span class="n">molStrLines</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">topCols</span><span class="p">)</span>
        <span class="n">numAtoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">numBonds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splitLine</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">runName</span>     <span class="o">=</span> <span class="n">runNameSplit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>          <span class="c"># eg &#39;acc1_D1_R2R200_Sp2_00_A48__Sp2_00__n1</span>
        <span class="n">runName</span>     <span class="o">=</span> <span class="n">runName</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>          <span class="c"># no empty space</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runNameSplit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>              <span class="c"># Error check for run type empty</span>
            <span class="n">runType</span> <span class="o">=</span> <span class="s">&quot;not specified&quot;</span>          <span class="c"># run string not found</span>
        <span class="k">else</span><span class="p">:</span>                                  <span class="c">#</span>
            <span class="n">runType</span>     <span class="o">=</span> <span class="n">runNameSplit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>      <span class="c"># eg &#39;TD-DFT&#39;</span>
            <span class="n">runType</span>     <span class="o">=</span> <span class="n">runType</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>      <span class="c"># no empty space</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # print molStr</span>
<span class="sd">        print &quot;------------------------------------------&quot;</span>
<span class="sd">        print &quot;runName  = &quot;, runName</span>
<span class="sd">        print &quot;numAtoms = &quot;, numAtoms</span>
<span class="sd">        print &quot;runType  = &quot;, runType</span>
<span class="sd">        print &quot;basis    = &quot;, basis</span>
<span class="sd">        print &quot;------------------------------------------\n&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ptcls</span> <span class="o">=</span> <span class="n">ParticleContainer</span><span class="p">()</span>               <span class="c"># Initialize STREAMM ptcl container</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">molStrLines</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="n">numAtoms</span><span class="p">]:</span>    <span class="c"># skips header (starts with positions)</span>
            <span class="n">col</span>   <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>                  <span class="c"># Split line into columns on whitespace</span>
            <span class="n">col2</span>  <span class="o">=</span> <span class="n">col</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>                       <span class="c"># Keep only [&#39;x&#39;, &#39;y&#39;, &#39;z&#39;, &#39;type&#39;]</span>
            <span class="n">pos</span>   <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">col2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="c"># Convert pos part to float eg [9.3830, 2.99, -1.2]</span>
            <span class="n">atype</span> <span class="o">=</span> <span class="n">col2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                      <span class="c"># Pick out string type separately</span>
            <span class="n">ptcl</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">atype</span><span class="p">)</span>           <span class="c"># Create particle (charge etc use defaults)</span>
            <span class="n">ptcls</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">ptcl</span><span class="p">)</span>                       <span class="c"># Put in struc container</span>

        <span class="n">struc</span>  <span class="o">=</span> <span class="n">StructureContainer</span><span class="p">(</span><span class="n">ptcls</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c"># Create struc from ptcl container</span>
        <span class="n">simObj</span> <span class="o">=</span> <span class="n">SimulationGaussian1</span><span class="p">(</span><span class="n">runName</span><span class="p">)</span>            <span class="c"># Create simulation obj</span>
        <span class="n">simObj</span><span class="o">.</span><span class="n">setDBBasisStr</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>                      <span class="c"># Store the &#39;basis&#39; string from database</span>
        <span class="n">simObj</span><span class="o">.</span><span class="n">copyStructureContainerInto</span><span class="p">(</span><span class="n">struc</span><span class="p">)</span>         <span class="c"># Initialize sim with struc</span>

        <span class="k">return</span> <span class="n">simObj</span>


</div>
<div class="viewcode-block" id="OPVSqlBase.createSimObjsFromTag"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.createSimObjsFromTag">[docs]</a>    <span class="k">def</span> <span class="nf">createSimObjsFromTag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagStr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For a tag string, returns coords from the database in a simulation object</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            tagStr (str) tag string of oligomer entry (eg D1_R3R3_A48__)</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of simulation objects (SimulationGaussian1)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot;select distinct &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot;tag,basis,mol &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot;from opv.vw_oligomer where &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="n">sqlExecStr</span> <span class="o">+</span> <span class="s">&quot;tag like &#39;&quot;</span> <span class="o">+</span> <span class="n">tagStr</span> <span class="o">+</span> <span class="s">&quot;&#39; &quot;</span>
                
        <span class="c"># Run command</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="c"># Convert mol string and mol info to simulation objects</span>
        <span class="n">simObjList</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">molStr</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">:</span>
            <span class="n">simObj</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molToSimObj</span><span class="p">(</span><span class="n">molStr</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">simObj</span><span class="o">.</span><span class="n">getSimName</span><span class="p">()</span>
            <span class="n">simObjList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simObj</span><span class="p">)</span>
            
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        SWS: may not be needed with checks elsewhere</span>
<span class="sd">        # Check on database result consistency, need a n1, n2 version</span>
<span class="sd">        # for each basis entry. Check if num found is even</span>
<span class="sd">        if not len(simObjList) % 2 == 0:</span>
<span class="sd">            print &quot; &quot; </span>
<span class="sd">            print &quot;Odd number of simulations in database found,&quot;</span>
<span class="sd">            print &quot;  need both n1 and n2 runs to initialize spam runs \n&quot;</span>
<span class="sd">            sys.exit(0)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">simObjList</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.getClusteringData"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.getClusteringData">[docs]</a>    <span class="k">def</span> <span class="nf">getClusteringData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">cullVal</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches structure db for all fields with the corresponding tags</span>
<span class="sd">        and makes a 3d scatter plot</span>

<span class="sd">        Args:</span>
<span class="sd">            eps  (float): distance param for clustering</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;tag,&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectStr</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;from opv.vw_structure&quot;</span>

        <span class="c"># Run command</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rList</span><span class="p">)</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="n">rList</span><span class="p">[:</span><span class="n">cullVal</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Analyzing # of results --&gt;&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rList</span><span class="p">),</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="c"># Analyze results</span>
        <span class="n">col0</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># tags</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 1</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 2</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rList</span><span class="p">]</span>  <span class="c"># search field 3</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">col3</span><span class="p">)</span>   <span class="c"># Make list of [ (x1,y1,z1), (x2..)...]</span>
        <span class="n">pts_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>      <span class="c"># Make numpy array of array</span>

        <span class="c"># Compute DBSCAN</span>
        <span class="n">pts_np</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">pts_np</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Before dbscan&quot;</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pts_np</span><span class="p">)</span>
        <span class="n">core_samples</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">core_sample_indices_</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">labels_</span>
        <span class="k">print</span> <span class="s">&quot;Labels = &quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Number of clusters &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>

        <span class="n">colors</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lb</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lb</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lb</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lb</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lb</span> <span class="o">==</span> <span class="mf">4.0</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lb</span> <span class="o">==</span> <span class="mf">5.0</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="mf">5.0</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">col3</span><span class="p">,</span> <span class="n">colors</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dat</span>

</div>
<div class="viewcode-block" id="OPVSqlBase.printTagInfo"><a class="viewcode-back" href="../db_interface.html#opvSQL.OPVSqlBase.printTagInfo">[docs]</a>    <span class="k">def</span> <span class="nf">printTagInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagStr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get tag info from the vw_oligomer database and print</span>

<span class="sd">        Args:</span>
<span class="sd">            tagStr (str): tag string in database eg D22_R3R3_Sp1_A4_R3_Sp1_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sqlExecStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;select &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;tag,oligomer_number &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;from opv.vw_oligomer where &quot;</span>
        <span class="n">sqlExecStr</span> <span class="o">+=</span> <span class="s">&quot;tag like &#39;&quot;</span> <span class="o">+</span> <span class="n">tagStr</span> <span class="o">+</span> <span class="s">&quot;&#39; &quot;</span>
               
        <span class="c"># Run command</span>
        <span class="n">rList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runSQLCmd</span><span class="p">(</span><span class="n">sqlExecStr</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="k">print</span> <span class="n">rList</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Dr. Scott W. Sides, Dr. Travis Kemper.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>