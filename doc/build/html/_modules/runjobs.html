<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>runjobs &mdash; STREAMM-Tools 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="STREAMM-Tools 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
  
<a href="../index.html"><img src="../_static/logo.png" border="0" alt="sampledoc"/></a>
</div>



  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          STREAMM-Tools</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Installation / Getting starting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../framework_design.html">STREAMM code description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Applications</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-12">
      
  <h1>Source code for runjobs</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A collection of classes for useful functions. Used throughout STREAMM</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">######################################################################</span>
<span class="c"># Load modules</span>
<span class="c">######################################################################</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: os and or sys not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check if python is on this system&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">string</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: string not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">math</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: math not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">re</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: re not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: time module not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: time module not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: optparse not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">platform</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: platform module not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">socket</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: socket module not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">shlex</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: subprocess,shlex module not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">copy</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: shutil and/or copy module(s) not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Error: fnmatch module not found&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Check &#39;PYTHONPATH&#39; and/or source bilder *.sh&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c">######################################################################</span>


<div class="viewcode-block" id="Misc"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Misc">[docs]</a><span class="k">class</span> <span class="nc">Misc</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of useful methods that do not clearly fit into other classes</span>
<span class="sd">    &quot;&quot;&quot;</span> 

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debugFlag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span> <span class="o">=</span> <span class="n">debugFlag</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Misc class created&quot;</span>
            <span class="k">print</span> <span class="s">&quot; debugFlag set to --&gt; &quot;</span><span class="p">,</span> <span class="n">debugFlag</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>


    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Misc class closed&quot;</span>


<div class="viewcode-block" id="Misc.recursive_glob"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Misc.recursive_glob">[docs]</a>    <span class="k">def</span> <span class="nf">recursive_glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">treeroot</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursive glob using the os.walk command to traverse</span>
<span class="sd">        directory structure. Starting from &#39;treeroot&#39; directory,</span>
<span class="sd">        return list of full path names for files containing &#39;pattern&#39;</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            treeroot (str): Directory name to start top of search</span>
<span class="sd">            pattern  (str): String pattern (can use * wildcard) for search</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of path name string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">treeroot</span><span class="p">):</span>
            <span class="n">goodfiles</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">goodfiles</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>


</div>
<div class="viewcode-block" id="Misc.getList"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Misc.getList">[docs]</a>    <span class="k">def</span> <span class="nf">getList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate list from x0, x0+dx,..... xmax</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xList</span><span class="o">=</span><span class="p">[]</span>    
        <span class="n">xList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
        <span class="n">xnext</span> <span class="o">=</span> <span class="n">x0</span><span class="o">+</span><span class="n">dx</span>
        <span class="k">while</span> <span class="n">xnext</span><span class="o">&lt;</span><span class="n">xmax</span><span class="p">:</span>
            <span class="n">xList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnext</span><span class="p">)</span>
            <span class="n">xnext</span> <span class="o">=</span> <span class="n">xnext</span><span class="o">+</span><span class="n">dx</span>
        <span class="k">return</span> <span class="n">xList</span>

</div>
<div class="viewcode-block" id="Misc.getTagForSorting"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Misc.getTagForSorting">[docs]</a>    <span class="k">def</span> <span class="nf">getTagForSorting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string with leading 0&#39;s so file systems etc</span>
<span class="sd">        sort is a normal way</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;</span> <span class="mi">9999</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;getTagForSorting: tag failed. Job num &gt; 9999&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tagTemplate</span> <span class="o">=</span> <span class="mi">100000</span>
        <span class="n">tagstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagTemplate</span><span class="o">+</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tagstr</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Misc.partitionList"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Misc.partitionList">[docs]</a>    <span class="k">def</span> <span class="nf">partitionList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">partLen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Partition list into chunks w the last chunk</span>
<span class="sd">        is the remainder of elements:</span>
<span class="sd">        </span>
<span class="sd">        data    --&gt; eg [1.2, 3.3, 55.6, 0.34.......3.1,38.2] (odd)</span>
<span class="sd">        partLen --&gt; eg 2</span>
<span class="sd">        chunks = [ [1.2, 3.3], [55.6, 0.34].... [38.2] ]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Make &#39;parts&#39; number of chunks</span>
        <span class="n">chunks</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">partLen</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">partLen</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">chunks</span>
</div>
<div class="viewcode-block" id="Misc.tupleOfLists2List"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Misc.tupleOfLists2List">[docs]</a>    <span class="k">def</span> <span class="nf">tupleOfLists2List</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take a tuple of lists and convert to single list</span>
<span class="sd">        eg ([a,b],[c,d],[e,f],...) --&gt;  [a,b,c,d,e,f]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bigList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tup</span><span class="p">:</span>
                <span class="n">bigList</span> <span class="o">=</span> <span class="n">bigList</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">bigList</span>

</div></div>
<div class="viewcode-block" id="IO"><a class="viewcode-back" href="../docstr_extras.html#runjobs.IO">[docs]</a><span class="k">class</span> <span class="nc">IO</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for managing output to files/screen</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">debugFlag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            fileName (str): string for file name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">fileName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span> <span class="o">=</span> <span class="n">debugFlag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;IO file object &quot;</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="s">&quot; opened&quot;</span>
            <span class="k">print</span> <span class="s">&quot; debugFlag set to --&gt; &quot;</span><span class="p">,</span> <span class="n">debugFlag</span>
            <span class="k">print</span> <span class="s">&quot; Flags can be reset in scripts by developers&quot;</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>


    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor (closes file)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fileObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;IO file object &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&quot; closed&quot;</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>

<div class="viewcode-block" id="IO.flush"><a class="viewcode-back" href="../docstr_extras.html#runjobs.IO.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flush the print buffer to the file object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileObj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="IO.prtdb"><a class="viewcode-back" href="../docstr_extras.html#runjobs.IO.prtdb">[docs]</a>    <span class="k">def</span> <span class="nf">prtdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prtString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print debug info if set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">prtString</span>
</div>
    <span class="k">def</span> <span class="nf">prtScreen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prtString</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">prtString</span>

<div class="viewcode-block" id="IO.prtFile"><a class="viewcode-back" href="../docstr_extras.html#runjobs.IO.prtFile">[docs]</a>    <span class="k">def</span> <span class="nf">prtFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prtString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only print to file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prtString</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot; </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="IO.prt"><a class="viewcode-back" href="../docstr_extras.html#runjobs.IO.prt">[docs]</a>    <span class="k">def</span> <span class="nf">prt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prtString</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write to screen and file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="n">prtString</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prtString</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot; </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="IO.floatToStr"><a class="viewcode-back" href="../docstr_extras.html#runjobs.IO.floatToStr">[docs]</a>    <span class="k">def</span> <span class="nf">floatToStr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert/format a float value to a string</span>

<span class="sd">        Args:</span>
<span class="sd">          x (float): value</span>
<span class="sd">          num (int): Size of format field</span>

<span class="sd">        Returns:</span>
<span class="sd">          string type value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">formatStr</span> <span class="o">=</span> <span class="s">&quot;%.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;f&quot;</span>
        <span class="n">xStr</span> <span class="o">=</span> <span class="n">formatStr</span> <span class="o">%</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">xStr</span>


<span class="c"># class FileEditorWithSomething:</span>
<span class="c">#    def __init__(self):</span>
<span class="c">#        pass</span>

</div></div>
<div class="viewcode-block" id="Job"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Job">[docs]</a><span class="k">class</span> <span class="nc">Job</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Job class representing data/members needed</span>
<span class="sd">    to represent an instance of a code that will run</span>
<span class="sd">    with a single set of input parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repopath</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span>
                 <span class="n">inputfile</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">auxFileList</span><span class="o">=</span><span class="p">[],</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">repopath</span> <span class="o">=</span> <span class="n">repopath</span>             <span class="c"># Path to repo for common files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span> <span class="o">=</span> <span class="n">exe</span>                       <span class="c"># Name of executable binary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span> <span class="o">=</span> <span class="n">inputfile</span>           <span class="c"># Name of input file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">script</span>                 <span class="c"># Name of script for PBS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># Suffix on PBS script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>               <span class="c"># Flag for debug printing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputEditorSet</span>  <span class="o">=</span> <span class="bp">False</span>         <span class="c"># Flag if input  file editor set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scriptEditorSet</span> <span class="o">=</span> <span class="bp">False</span>         <span class="c"># Flag if script file editor set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auxFileList</span> <span class="o">=</span> <span class="n">auxFileList</span>       <span class="c"># List of optional files</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Job object template created with verbosity on&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Job object template created with verbosity off&quot;</span>

        <span class="c"># Check for repo path</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">repopath</span><span class="p">)):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Repo path &quot;</span><span class="p">,</span> <span class="n">repopath</span><span class="p">,</span> <span class="s">&quot; not found&quot;</span>
            <span class="k">print</span> <span class="s">&quot;Edit createJobsDirs.py:repoPath by hand for your path&quot;</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check for full paths of needed files</span>
        <span class="n">exePath</span>    <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">)</span>
        <span class="n">inputPath</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span><span class="p">)</span>
        <span class="n">scriptPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exePath</span><span class="p">)):</span>
            <span class="k">print</span> <span class="s">&quot;Executable &quot;</span><span class="p">,</span> <span class="n">exePath</span><span class="p">,</span> <span class="s">&quot; not found </span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputPath</span><span class="p">)):</span>
            <span class="k">print</span> <span class="s">&quot;Input file template &quot;</span><span class="p">,</span> <span class="n">inputPath</span><span class="p">,</span> <span class="s">&quot; not found </span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">scriptPath</span><span class="p">)):</span>
            <span class="k">print</span> <span class="s">&quot;Queue script &quot;</span><span class="p">,</span> <span class="n">scriptPath</span><span class="p">,</span> <span class="s">&quot; not found </span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c"># Check for full paths of all auxillary files</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">auxFileList</span><span class="p">:</span>
            <span class="n">auxPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">auxPath</span><span class="p">)):</span>
                <span class="k">print</span> <span class="s">&quot;Auxillary file &quot;</span><span class="p">,</span> <span class="n">auxPath</span><span class="p">,</span> <span class="s">&quot; not found </span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


    <span class="c"># Destructor</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;Destructor called&quot;</span>

    <span class="c"># Setters (can be used to reset a member for a specific run)</span>
    <span class="k">def</span> <span class="nf">setExecutable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exe</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exe</span> <span class="o">=</span> <span class="n">exe</span>
    <span class="k">def</span> <span class="nf">setRepoPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repopath</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repopath</span> <span class="o">=</span> <span class="n">repopath</span>
    <span class="k">def</span> <span class="nf">setInputFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span> <span class="o">=</span> <span class="n">inputfile</span>
    <span class="k">def</span> <span class="nf">setRunDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rundir</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span> <span class="o">=</span> <span class="n">rundir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rundirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">rundir</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setScript</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="n">script</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># script.mb --&gt; mbn1</span>

<div class="viewcode-block" id="Job.setInputEditor"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Job.setInputEditor">[docs]</a>    <span class="k">def</span> <span class="nf">setInputEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expects an editor object that implements the</span>
<span class="sd">        appropriate &#39;editFile(..)&#39; method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inputEditorSet</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputEditor</span> <span class="o">=</span> <span class="n">editor</span>

</div>
<div class="viewcode-block" id="Job.setScriptEditor"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Job.setScriptEditor">[docs]</a>    <span class="k">def</span> <span class="nf">setScriptEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expects an editor object that implements the</span>
<span class="sd">        appropriate &#39;editFile(..)&#39; method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scriptEditorSet</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scriptEditor</span> <span class="o">=</span> <span class="n">editor</span>

        </div>
<div class="viewcode-block" id="Job.info"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Job.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dump state of object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span> <span class="s">&quot; &quot;</span>
        <span class="k">print</span> <span class="s">&quot;Data members set to: &quot;</span>
        <span class="k">print</span> <span class="s">&quot;   repopath  = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repopath</span>
        <span class="k">print</span> <span class="s">&quot;   rundir    = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span>
        <span class="k">print</span> <span class="s">&quot;   exe       = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span>
        <span class="k">print</span> <span class="s">&quot;   inputfile = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span>
        <span class="k">print</span> <span class="s">&quot;   script    = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span>
        <span class="k">print</span> <span class="s">&quot; &quot;</span>

</div>
<div class="viewcode-block" id="Job.createJobRun"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Job.createJobRun">[docs]</a>    <span class="k">def</span> <span class="nf">createJobRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create run directory and populate with appropriate files</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Local full paths of needed files</span>
        <span class="n">exePath</span>    <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exe</span><span class="p">)</span>
        <span class="n">inputPath</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span><span class="p">)</span>
        <span class="n">scriptPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">)</span>

        <span class="c"># If run directory doesnt exist, create it</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">)):</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">,</span> <span class="s">&quot; already exists, skipping to next </span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Creating/setting up job directory &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span>
            <span class="k">print</span> <span class="s">&quot;   exePath     = &quot;</span><span class="p">,</span> <span class="n">exePath</span>
            <span class="k">print</span> <span class="s">&quot;   inputPath   = &quot;</span><span class="p">,</span> <span class="n">inputPath</span>
            <span class="k">print</span> <span class="s">&quot;   scriptPath  = &quot;</span><span class="p">,</span> <span class="n">scriptPath</span>
            <span class="k">print</span> <span class="s">&quot;   auxFileList = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auxFileList</span>

        <span class="c"># Copy repo files to run directory</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">exePath</span><span class="p">,</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">inputPath</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">scriptPath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">)</span>

        <span class="c"># Copy auxillary repo files to run directory</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">auxFileList</span><span class="p">:</span>
            <span class="n">auxPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repopath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">auxPath</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">)</span>

        <span class="c"># Unique integer timestamp for script names</span>
        <span class="c"># (when submitting simul. from different directories)</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="n">timeStamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="c"># Copy repo script name to run directory with run dir name</span>
        <span class="c"># Note: this CHANGES class data</span>
        <span class="n">oldScriptFullPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rundirName</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timeStamp</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span>
        <span class="n">newScriptFullPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">oldScriptFullPath</span><span class="p">,</span> <span class="n">newScriptFullPath</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Job.changeInputFile"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Job.changeInputFile">[docs]</a>    <span class="k">def</span> <span class="nf">changeInputFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use imported edit methods to change input file for run</span>
<span class="sd">        The imported method must implement an &#39;editfile(file)&#39; method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputEditorSet</span><span class="p">):</span>
            <span class="n">currFile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputEditor</span><span class="o">.</span><span class="n">editFile</span><span class="p">(</span><span class="n">currFile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Input file editor not set. &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span><span class="p">,</span> <span class="s">&quot; is unchanged&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Job.changeScriptFile"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Job.changeScriptFile">[docs]</a>    <span class="k">def</span> <span class="nf">changeScriptFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use imported edit methods to change script file for run</span>
<span class="sd">        The imported method must implement an &#39;editfile(file)&#39; method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scriptEditorSet</span><span class="p">):</span>
            <span class="n">currFile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rundir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scriptEditor</span><span class="o">.</span><span class="n">editFile</span><span class="p">(</span><span class="n">currFile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Scriptfile editor not set. &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="p">,</span> <span class="s">&quot; is unchanged&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="JobStatus"><a class="viewcode-back" href="../docstr_extras.html#runjobs.JobStatus">[docs]</a><span class="k">class</span> <span class="nc">JobStatus</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class containing members needed to inquire about job status once</span>
<span class="sd">    already created and populated by necessary files/scripts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>       <span class="c"># Flag for debug printing</span>


    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;Destructor called&quot;</span>
    

<div class="viewcode-block" id="JobStatus.isJobInQueue"><a class="viewcode-back" href="../docstr_extras.html#runjobs.JobStatus.isJobInQueue">[docs]</a>    <span class="k">def</span> <span class="nf">isJobInQueue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobdir</span><span class="p">,</span> <span class="n">jobscript</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method will be inherited by derived classes as all</span>
<span class="sd">        jobs are assumed to be in queueing system and running jobs</span>
<span class="sd">        will have same signature</span>
<span class="sd">        </span>
<span class="sd">        NOTE: method logic assumes that .pbs file name is the job</span>
<span class="sd">        name to look for</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># jobdir=/home/ssides/opv/opv_generator/mols/D1_R16R100_A1_R3R30000_</span>
        <span class="c"># jobscript = acc1_D1_R16R100_A1_R3R30000__n1.pbs </span>
        <span class="c"># jobdirName = os.path.basename(jobscript) # D1_R16R100_A1_R3R30000_ </span>
        <span class="n">jobname</span> <span class="o">=</span> <span class="n">jobscript</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># acc1_D1_R16R100_A1_R3R30000__n1</span>

        <span class="c">#</span>
        <span class="c"># Set submit command</span>
        <span class="c"># Takes qstat -f output and returns 8 lines of output after the &#39;jobname&#39; is found</span>
        <span class="c"># Must grep this because location of job_state line changes</span>
        <span class="c">#</span>
        <span class="n">qcommand</span> <span class="o">=</span> <span class="s">&quot; qstat -f | awk &#39;/&quot;</span> <span class="o">+</span> <span class="n">jobname</span> <span class="o">+</span> \
                   <span class="s">&quot;/ {for(i=1; i&lt;=8; i++) {getline; print}}&#39; |grep job_state&quot;</span>

        <span class="c"># Runs submission command and grabs output</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">qcommand</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

        <span class="c"># Success code from qcommand</span>
        <span class="n">return_code</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="c"># If command fails, then nothing found in queue</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">return_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">jobInQueue</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Read from pipes, line should be eg &#39;job_state = R&#39;</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="n">splitStr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">jobstate</span> <span class="o">=</span> <span class="n">splitStr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span> <span class="s">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">jobstate</span> <span class="p">):</span>
                    <span class="n">jobInQueue</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="p">(</span> <span class="s">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">jobstate</span> <span class="p">):</span>
                    <span class="n">jobInQueue</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="p">(</span> <span class="s">&#39;C&#39;</span> <span class="ow">in</span> <span class="n">jobstate</span> <span class="p">):</span>
                    <span class="n">jobInQueue</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">jobInQueue</span> <span class="o">=</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="n">jobInQueue</span>


</div>
<div class="viewcode-block" id="JobStatus.isJobDone"><a class="viewcode-back" href="../docstr_extras.html#runjobs.JobStatus.isJobDone">[docs]</a>    <span class="k">def</span> <span class="nf">isJobDone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobdir</span><span class="p">,</span> <span class="n">jobscript</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds &#39;code specific&#39; finish condition for a particular run.</span>
<span class="sd">        Assumes that call is made from correct run directory</span>
<span class="sd">        </span>
<span class="sd">        This method can be redefined for other &#39;finish&#39; criteria</span>
<span class="sd">        It must be defined as</span>
<span class="sd">        </span>
<span class="sd">        def isJobDone(jobdir, jobscript):</span>
<span class="sd">        ...</span>
<span class="sd">        ...</span>
<span class="sd">        return isDone (True/False)</span>
<span class="sd">    </span>
<span class="sd">        Note: This call is defaulting to a job NOT being finished if</span>
<span class="sd">        a specific isJobDone is not defined for a given applic.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span> <span class="s">&quot;No JobStatus:isJobDone method defined... set job to NOT done&quot;</span>
        <span class="k">return</span> <span class="bp">False</span>



</div></div>
<div class="viewcode-block" id="FileEditorWithTags"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags">[docs]</a><span class="k">class</span> <span class="nc">FileEditorWithTags</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates objects capable of editing files by replacing string tags</span>
<span class="sd">    with values. The correspondence between these tags and values are</span>
<span class="sd">    specified by the dictionary objects:</span>
<span class="sd">    </span>
<span class="sd">    &#39;tagValDict&#39;    --&gt; actual dictionary used to do string replacements</span>
<span class="sd">    &#39;tagValDictTpl&#39; --&gt; dictionary template used by class method to automatically</span>
<span class="sd">     </span>
<span class="sd">    Create new file edit objects with one parameter &#39;sweeping&#39; over a series of specified values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagValDictTpl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor (set base level input file values)</span>
<span class="sd">        These are used as template on which to do sweeps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagValDictTpl</span> <span class="o">=</span> <span class="n">tagValDictTpl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagValDict</span>    <span class="o">=</span> <span class="n">tagValDictTpl</span>


    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="FileEditorWithTags.setDictValue"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.setDictValue">[docs]</a>    <span class="k">def</span> <span class="nf">setDictValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter for dictionary values from assignment string</span>
<span class="sd">        eg obj.setDictValue(&#39;EDIT_x=0.30&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">splitStr</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">splitStr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">splitStr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagValDict</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;tag &quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="s">&quot;not found in setDictValue(...)&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Try to convert val to number</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tagValDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># If fails assume that val is a string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tagValDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

</div>
<div class="viewcode-block" id="FileEditorWithTags.setDictTplValue"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.setDictTplValue">[docs]</a>    <span class="k">def</span> <span class="nf">setDictTplValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter for TEMPLATE dictionary values from assignment string</span>
<span class="sd">        eg obj.setDictTplValue(&#39;EDIT_x=0.30&#39;)</span>
<span class="sd">        </span>
<span class="sd">        NOTE: when one wants a sweep over a different parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">splitStr</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">splitStr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">splitStr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagValDictTpl</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;tag &quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="s">&quot;not found in setDictValue(...)&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Try to convert val to number</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tagValDictTpl</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># If fails assume that val is a string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tagValDictTpl</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

</div>
<div class="viewcode-block" id="FileEditorWithTags.setDict"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.setDict">[docs]</a>    <span class="k">def</span> <span class="nf">setDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagValDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter for new dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagValDict</span> <span class="o">=</span> <span class="n">tagValDict</span>

</div>
<div class="viewcode-block" id="FileEditorWithTags.setDictTpl"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.setDictTpl">[docs]</a>    <span class="k">def</span> <span class="nf">setDictTpl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tagValDictTpl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter for new dictionary template</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagValDictTpl</span> <span class="o">=</span> <span class="n">tagValDictTpl</span>

</div>
<div class="viewcode-block" id="FileEditorWithTags.show"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the current dictionary to be used</span>
<span class="sd">        to edit a file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;tag edit info: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagValDict</span>

</div>
<div class="viewcode-block" id="FileEditorWithTags.fileLines"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.fileLines">[docs]</a>    <span class="k">def</span> <span class="nf">fileLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count lines in file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

</div>
<div class="viewcode-block" id="FileEditorWithTags.getParamSweeps"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.getParamSweeps">[docs]</a>    <span class="k">def</span> <span class="nf">getParamSweeps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a factory which creates copies of this object</span>
<span class="sd">        Return a list of copied file edit objects generated by sweeping over</span>
<span class="sd">        &#39;param&#39; values for &#39;tag&#39; in the dictionary template.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Blank list of copied file objects</span>
        <span class="n">fEditObjList</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">fEditObj</span> <span class="o">=</span> <span class="n">FileEditorWithTags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagValDictTpl</span><span class="p">)</span> <span class="c"># Create new file edit object</span>
            <span class="n">tagValDict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tagValDictTpl</span><span class="p">)</span>        <span class="c"># copy dictionary from template</span>
            <span class="n">tagValDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>                               <span class="c"># edit the dictionary for new value</span>
            <span class="n">fEditObj</span><span class="o">.</span><span class="n">setDict</span><span class="p">(</span><span class="n">tagValDict</span><span class="p">)</span>                      <span class="c"># set new dictionary in copied file edit object</span>
            <span class="n">fEditObjList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fEditObj</span><span class="p">)</span>                     <span class="c"># Store fedit obj in list</span>

        <span class="k">return</span> <span class="n">fEditObjList</span>

</div>
<div class="viewcode-block" id="FileEditorWithTags.editFile"><a class="viewcode-back" href="../docstr_extras.html#runjobs.FileEditorWithTags.editFile">[docs]</a>    <span class="k">def</span> <span class="nf">editFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inFile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take each line in file and replace tagged strings</span>
<span class="sd">        with values to be set. tagValDict is a dictionary eg</span>
<span class="sd">        </span>
<span class="sd">        tagValDict[&#39;EDIT_x1&#39; ] = 0.232</span>
<span class="sd">        tagValDict[&#39;EDIT_x2&#39;]  = 134</span>
<span class="sd">        tagValDict[&#39;EDIT_x3&#39;]  = 0.456</span>
<span class="sd">        ....</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Local copy for replace dictionary</span>
        <span class="n">tagValDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagValDict</span>
        
        <span class="n">outFile</span><span class="o">=</span><span class="s">&#39;tmp.in&#39;</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">inFile</span><span class="p">,</span>  <span class="s">&#39;r+&#39;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="c"># Loop over all lines in file</span>
        <span class="c"># SWS: can simplify the &#39;in&#39; syntax</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileLines</span><span class="p">(</span><span class="n">inFile</span><span class="p">)):</span>
            <span class="n">strline</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

            <span class="c"># Loop over tags and replace each</span>
            <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">tagValDict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">strline</span><span class="o">=</span><span class="n">strline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="n">tag</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strline</span><span class="p">)</span>

        <span class="c"># Close local files</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">g</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Copy over template file w/new file</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="n">inFile</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Geometry"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Geometry">[docs]</a><span class="k">class</span> <span class="nc">Geometry</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of geometric/math methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debugFlag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span> <span class="o">=</span> <span class="n">debugFlag</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Geometry class created&quot;</span>
            <span class="k">print</span> <span class="s">&quot; debugFlag set to --&gt; &quot;</span><span class="p">,</span> <span class="n">debugFlag</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>


    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Destructor &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Geometry class closed&quot;</span>


<div class="viewcode-block" id="Geometry.rdist"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Geometry.rdist">[docs]</a>    <span class="k">def</span> <span class="nf">rdist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cartestian dist between pt1-pt2 (in list [] format)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pt1 : python list [x,y,z]</span>
<span class="sd">            pt2 : python list [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdistSqr</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Geometry.rdistSqr"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Geometry.rdistSqr">[docs]</a>    <span class="k">def</span> <span class="nf">rdistSqr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Squared Cartestian dist between pt1-pt2 (in list [] format)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pt1 : python list [x,y,z]</span>
<span class="sd">            pt2 : python list [x,y,z]</span>
<span class="sd">        Returns:</span>
<span class="sd">            float value for cartestian distance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pt1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">pt1</span><span class="p">)</span>   <span class="c"># Ensure args are type float</span>
        <span class="n">pt2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">pt2</span><span class="p">)</span>

        <span class="n">delR</span><span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="o">.</span><span class="n">__sub__</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>   <span class="c"># Subtracts coord lists elementwise</span>
        <span class="n">dR2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">pow</span><span class="p">,</span> <span class="n">delR</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">delR</span><span class="p">))</span>  <span class="c"># Square each element</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dR2</span><span class="p">)</span>                             <span class="c"># Sum elements</span>

</div>
<div class="viewcode-block" id="Geometry.rdistPBCbox"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Geometry.rdistPBCbox">[docs]</a>    <span class="k">def</span> <span class="nf">rdistPBCbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">bsize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cartestian dist between pt1-pt2 (in list [] format)</span>
<span class="sd">        Finds minimun distance assuming points are located inside a rectangular</span>
<span class="sd">        box with sizes in bsize = [Lx, Ly, Lz]</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pt1 : python list [x,y,z]</span>
<span class="sd">            pt2 : python list [x,y,z]</span>
<span class="sd">            bsize : python list [Lx, Ly, Lz]</span>
<span class="sd">        Returns:</span>
<span class="sd">            float value for cartestian distance in periodic box</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdistPBCboxSqr</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">bsize</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Geometry.rdistPBCboxSqr"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Geometry.rdistPBCboxSqr">[docs]</a>    <span class="k">def</span> <span class="nf">rdistPBCboxSqr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">bsize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Squrared Cartestian dist between pt1-pt2 (in list [] format)</span>
<span class="sd">        Finds minimun distance assuming points are located inside a rectangular</span>
<span class="sd">        box with sizes in bsize = [Lx, Ly, Lz]</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pt1 : python list [x,y,z]</span>
<span class="sd">            pt2 : python list [x,y,z]</span>
<span class="sd">            bsize : python list [Lx, Ly, Lz]</span>
<span class="sd">        Returns:</span>
<span class="sd">           float value for cartestian distance squared periodic box</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pt1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">pt1</span><span class="p">)</span>   <span class="c"># Ensure args are type float</span>
        <span class="n">pt2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">pt2</span><span class="p">)</span>
        <span class="n">bsize</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">bsize</span><span class="p">)</span>

        <span class="n">diff</span>    <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="o">.</span><span class="n">__sub__</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>     <span class="c"># Subtracts coord lists elementwise</span>
        <span class="n">adelR</span>   <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>             <span class="c"># Take abs val elem-wise</span>
        <span class="n">delRBox</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="o">.</span><span class="n">__sub__</span><span class="p">,</span> <span class="n">bsize</span><span class="p">,</span> <span class="n">adelR</span><span class="p">)</span> <span class="c"># Subtract coord diff from box</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">delRBox</span><span class="p">):</span>    <span class="c"># Select smallest coord diff elem-wise</span>
            <span class="n">minDel</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">adelR</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>     <span class="c"># Store min results in delR list</span>
            <span class="n">adelR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">minDel</span>               <span class="c">#</span>

        <span class="n">dR2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">pow</span><span class="p">,</span> <span class="n">adelR</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">adelR</span><span class="p">))</span> <span class="c"># Square each element</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dR2</span><span class="p">)</span>                       <span class="c"># Sum elements and take root</span>

</div>
<div class="viewcode-block" id="Geometry.rdistInBounds"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Geometry.rdistInBounds">[docs]</a>    <span class="k">def</span> <span class="nf">rdistInBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">rcutoff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only checks x-coord with cutoff to determine</span>
<span class="sd">        bound for Cartesian distance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idir</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dr</span>  <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt2</span><span class="p">[</span><span class="n">idir</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dr</span> <span class="o">&gt;=</span> <span class="n">rcutoff</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="Geometry.rdistInBoundsPBC"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Geometry.rdistInBoundsPBC">[docs]</a>    <span class="k">def</span> <span class="nf">rdistInBoundsPBC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">rcutoff</span><span class="p">,</span> <span class="n">bsize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only checks idir-coord with cutoff to determine</span>
<span class="sd">        bound for Cartesian distance.</span>
<span class="sd">        NOTE: TEsting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idir</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dr</span>  <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt2</span><span class="p">[</span><span class="n">idir</span><span class="p">])</span>
        <span class="n">drL</span> <span class="o">=</span> <span class="n">bsize</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dr</span> <span class="o">&gt;=</span> <span class="n">rcutoff</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">drL</span> <span class="o">&gt;=</span> <span class="n">rcutoff</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">dr</span>  <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt2</span><span class="p">[</span><span class="n">idir</span><span class="p">])</span>
        <span class="n">drL</span> <span class="o">=</span> <span class="n">bsize</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dr</span> <span class="o">&gt;=</span> <span class="n">rcutoff</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">drL</span> <span class="o">&gt;=</span> <span class="n">rcutoff</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>


</div></div>
<div class="viewcode-block" id="Histogram1D"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Histogram1D">[docs]</a><span class="k">class</span> <span class="nc">Histogram1D</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of binning/histogram methods in 1D</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">numbins</span><span class="p">,</span> <span class="n">debugFlag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numbins</span> <span class="o">=</span> <span class="n">numbins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span> <span class="o">=</span> <span class="n">debugFlag</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;1D histogram class created&quot;</span>
            <span class="k">print</span> <span class="s">&quot; debugFlag set to --&gt; &quot;</span><span class="p">,</span> <span class="n">debugFlag</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>

        <span class="c"># Associated histogram parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binsize</span>  <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">numbins</span><span class="p">)</span>

        <span class="c"># Positions of midpoints of each bin based on xmin/max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binvals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">binpos</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binsize</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ibin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numbins</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">binpos</span><span class="p">)</span>
            <span class="n">binpos</span> <span class="o">=</span> <span class="n">binpos</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">binsize</span>


    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Histogram1D class closed&quot;</span>


<div class="viewcode-block" id="Histogram1D.setWeights"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Histogram1D.setWeights">[docs]</a>    <span class="k">def</span> <span class="nf">setWeights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;        </span>
<span class="sd">        &#39;weights&#39; is the factor that bin counting is weighted by. If no</span>
<span class="sd">        weights are given then the default for all data is --&gt; &#39;1&#39;. If</span>
<span class="sd">        weights are given is should be a list with length equal to len(data)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">wts</span>

</div>
<div class="viewcode-block" id="Histogram1D.getHistogramNorm"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Histogram1D.getHistogramNorm">[docs]</a>    <span class="k">def</span> <span class="nf">getHistogramNorm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns tuple with bin positions and normalized histogram for all</span>
<span class="sd">        values in &#39;data&#39;, this is a driver for getBinning().</span>

<span class="sd">        NOTE: !!!!!!! ----- The exact meaning of this norm factor needs clarification</span>

<span class="sd">        Args:</span>
<span class="sd">            data (list) positions that will be binned given params used to construct this object</span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple with (bin-values, histogram)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">binCounts</span><span class="p">,</span> <span class="n">binWeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getBinning</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">totalCounts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">binCounts</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binsize</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">totalCounts</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="n">normHist</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="n">norm</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">binCounts</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binvals</span><span class="p">,</span> <span class="n">normHist</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Histogram1D.getHistogram"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Histogram1D.getHistogram">[docs]</a>    <span class="k">def</span> <span class="nf">getHistogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns tuple with bin positions and raw binned histogram (raw counts) for all</span>
<span class="sd">        values in &#39;data&#39;, this is a driver for getBinning().</span>

<span class="sd">        Args:</span>
<span class="sd">            data (list) positions that will be binned given params used to construct this object</span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple with (bin-values, raw histogram)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">binCounts</span><span class="p">,</span> <span class="n">binWeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getBinning</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binvals</span><span class="p">,</span> <span class="n">binCounts</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Histogram1D.getHistogramWeighted"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Histogram1D.getHistogramWeighted">[docs]</a>    <span class="k">def</span> <span class="nf">getHistogramWeighted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns tuple with bin positions and raw binned histogram (raw counts) for all</span>
<span class="sd">        values in &#39;data&#39;, this is a driver for getBinning().</span>

<span class="sd">        Args:</span>
<span class="sd">            data (list) positions that will be binned given params used to construct this object</span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple with (bin-values, raw histogram)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">binCounts</span><span class="p">,</span> <span class="n">binWeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getBinning</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binvals</span><span class="p">,</span> <span class="n">binWeights</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Histogram1D.getHistogramWeightedAvePerBin"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Histogram1D.getHistogramWeightedAvePerBin">[docs]</a>    <span class="k">def</span> <span class="nf">getHistogramWeightedAvePerBin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns tuple with bin positions and binned histogram for all</span>
<span class="sd">        values in &#39;data&#39;, this is a driver for getBinning() using the total weight</span>
<span class="sd">        per bin / (number of counts) for each bin</span>

<span class="sd">        Args:</span>
<span class="sd">            data (list) positions that will be binned given params used to construct this object</span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple with (bin-values, raw histogram)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">binCounts</span><span class="p">,</span> <span class="n">binWeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getBinning</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ibin</span><span class="p">,</span> <span class="n">ibinWeight</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">binWeights</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">binCounts</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
               <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">=</span> <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">=</span> <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span><span class="o">/</span><span class="n">binCounts</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binvals</span><span class="p">,</span> <span class="n">binWeights</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Histogram1D.getBinSize"><a class="viewcode-back" href="../docstr_extras.html#runjobs.Histogram1D.getBinSize">[docs]</a>    <span class="k">def</span> <span class="nf">getBinSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return calculated binsize</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binsize</span>

</div>
    <span class="k">def</span> <span class="nf">_getBinning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses the output from bin1DList to get the binning info</span>
<span class="sd">        (used to generate the histogram data). Calculates number of values</span>
<span class="sd">        in each bin. Calculates total weighted counts for each bin.</span>

<span class="sd">        Note: If weights not set then binCounts == binWeights</span>

<span class="sd">        Args:</span>
<span class="sd">            data (list) raw 1D list of data values</span>
<span class="sd">            </span>
<span class="sd">        Return: tuple of binCounts, binWeights. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">binList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bin1DList</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">binCounts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numbins</span><span class="p">)]</span>
        <span class="n">binWeights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numbins</span><span class="p">)]</span>

        <span class="c"># print &quot;binList = &quot;, binList, len(binList)</span>
        <span class="c"># print &quot;binCounts = &quot;, binCounts, len(binCounts)</span>

        <span class="k">if</span> <span class="bp">None</span> <span class="ow">in</span> <span class="n">binList</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;_bin1DList call failed... values outside of limits&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)):</span>
                <span class="k">print</span> <span class="s">&quot;getBinning: len(weights) != to len(data)&quot;</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="c"># If weights have been set...</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ibin</span> <span class="ow">in</span> <span class="n">binList</span><span class="p">:</span>
                <span class="n">binCounts</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">=</span> <span class="n">binCounts</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">=</span> <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ibin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">binList</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">binCounts</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span>  <span class="o">=</span> <span class="n">binCounts</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">=</span> <span class="n">binWeights</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+</span> <span class="n">count</span>

        <span class="k">return</span> <span class="n">binCounts</span><span class="p">,</span> <span class="n">binWeights</span>


    <span class="k">def</span> <span class="nf">_getBinVals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return position list of midpoints of bins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binvals</span>


    <span class="k">def</span> <span class="nf">_bin1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bins returned run from 0--&gt;(numbins-1)</span>
<span class="sd">        If value outside of range set in constructor then</span>
<span class="sd">        &#39;None&#39; is returned</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># if ( (val &lt;= self.xmin) or (val &gt;= self.xmax) ):</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span> <span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ibin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">val</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">binsize</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">ibin</span>


    <span class="k">def</span> <span class="nf">_bin1DList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Driver for bin1D(val) for a list of values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bin1D</span><span class="p">,</span> <span class="n">valList</span><span class="p">)</span>



</div>
<div class="viewcode-block" id="EditFileLines"><a class="viewcode-back" href="../docstr_extras.html#runjobs.EditFileLines">[docs]</a><span class="k">class</span> <span class="nc">EditFileLines</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an object that can edit a file by manipulating lines</span>
<span class="sd">    Close in spirit to bash utilities like &#39;sed&#39; and &#39;awk&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputfile</span><span class="p">,</span> <span class="n">debugFlag</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Input file name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span> <span class="o">=</span> <span class="n">inputfile</span>

        <span class="c"># File object for input name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span> <span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">inputfile</span><span class="p">,</span>  <span class="s">&#39;r+&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span> <span class="o">=</span> <span class="n">debugFlag</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Misc class created&quot;</span>
            <span class="k">print</span> <span class="s">&quot; debugFlag set to --&gt; &quot;</span><span class="p">,</span> <span class="n">debugFlag</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>


    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Close open file object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debugFlag</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot; &quot;</span>
            <span class="k">print</span> <span class="s">&quot;Misc class closed&quot;</span>


<div class="viewcode-block" id="EditFileLines.fileLines"><a class="viewcode-back" href="../docstr_extras.html#runjobs.EditFileLines.fileLines">[docs]</a>    <span class="k">def</span> <span class="nf">fileLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count lines in the input file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># Reset file position</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>        

</div>
<div class="viewcode-block" id="EditFileLines.getLinesAfter"><a class="viewcode-back" href="../docstr_extras.html#runjobs.EditFileLines.getLinesAfter">[docs]</a>    <span class="k">def</span> <span class="nf">getLinesAfter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startnum</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return file lines after a line number. First line in file is &#39;1&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            startnum (int) Line number of file to start returning lines after</span>

<span class="sd">        Returns:</span>
<span class="sd">            Return list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">linenum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">getLines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">linenum</span> <span class="o">&lt;</span> <span class="n">startnum</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">getLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">linenum</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">getLines</span>


</div>
<div class="viewcode-block" id="EditFileLines.getLinesBetween"><a class="viewcode-back" href="../docstr_extras.html#runjobs.EditFileLines.getLinesBetween">[docs]</a>    <span class="k">def</span> <span class="nf">getLinesBetween</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get file lines in-between specified line strings.</span>

<span class="sd">        Args:</span>
<span class="sd">            start (str): String in file to begin section</span>
<span class="sd">            end   (str): String in file to end section</span>

<span class="sd">        Returns:</span>
<span class="sd">            Return list of strings (not including start and end string)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">startFound</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c"># Flag for finding start string</span>
        <span class="n">endFound</span>   <span class="o">=</span> <span class="bp">False</span>  <span class="c"># Flag for finding end string</span>
        <span class="n">outLines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>   <span class="c"># Declare output list result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c"># Reset pointer for file</span>
        
        <span class="c"># Loop over all lines in file until start string found and end string found</span>
        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">endFound</span><span class="p">):</span>

            <span class="c"># Read line and break out of loop for EOF</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c"># Set start/end flags</span>
            <span class="n">strline</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">strline</span><span class="p">:</span>
                <span class="n">startFound</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">end</span> <span class="o">==</span> <span class="n">strline</span><span class="p">)</span> <span class="ow">and</span> <span class="n">startFound</span><span class="p">:</span>
                <span class="n">endFound</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c"># Decide to append line between start-end string</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">startFound</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">endFound</span><span class="p">)</span> <span class="p">):</span>
                <span class="n">outLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strline</span><span class="p">)</span>

        <span class="c"># Leave off start line in result</span>
        <span class="k">return</span> <span class="n">outLines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>


</div>
<div class="viewcode-block" id="EditFileLines.insertLinesAfter"><a class="viewcode-back" href="../docstr_extras.html#runjobs.EditFileLines.insertLinesAfter">[docs]</a>    <span class="k">def</span> <span class="nf">insertLinesAfter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linesList</span><span class="p">,</span> <span class="n">start</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert lines after the search string</span>

<span class="sd">        Args:</span>
<span class="sd">            linesList (list): List of strings to insert</span>
<span class="sd">            start      (str): Search string marker to insert after</span>

<span class="sd">        Returns:</span>
<span class="sd">            Edits the internal file object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">oldLinesBefore</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">oldLinesAfter</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">startFound</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c"># Flag for finding start string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c"># Reset pointer for file</span>

        <span class="c"># Open file for edited content</span>
        <span class="n">editFileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span> <span class="o">+</span> <span class="s">&quot;.inserted&quot;</span>
        <span class="n">newfobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">editFileName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="c"># Loop over all lines in file and split lines depending on &#39;start&#39; string</span>
        <span class="k">for</span> <span class="n">oldline</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="p">:</span>

            <span class="c"># Write out part of old file to new file before insert string</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">startFound</span><span class="p">:</span>
                <span class="n">oldLinesBefore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oldline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oldLinesAfter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oldline</span><span class="p">)</span>

            <span class="c"># Check for start line</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">oldline</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">startFound</span> <span class="o">=</span> <span class="bp">True</span>
                
        <span class="n">newfobj</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">oldLinesBefore</span><span class="p">)</span> <span class="c"># Write out before chunk</span>
        <span class="n">newfobj</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">linesList</span><span class="p">)</span>      <span class="c"># Write out insert chunk</span>
        <span class="n">newfobj</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">oldLinesAfter</span><span class="p">)</span>  <span class="c"># Write out after  chunk</span>
        <span class="n">newfobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>                    <span class="c"># Close new edited file</span>

        <span class="k">print</span> <span class="s">&quot;Created file &quot;</span><span class="p">,</span> <span class="n">editFileName</span>

</div>
<div class="viewcode-block" id="EditFileLines.deleteLinesBetween"><a class="viewcode-back" href="../docstr_extras.html#runjobs.EditFileLines.deleteLinesBetween">[docs]</a>    <span class="k">def</span> <span class="nf">deleteLinesBetween</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove file lines in-between specified line strings.</span>

<span class="sd">        Args:</span>
<span class="sd">            start (str): String in file to begin section</span>
<span class="sd">            end   (str): String in file to end section</span>

<span class="sd">        Returns:</span>
<span class="sd">            Return list of strings (not including start and end string)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">startFound</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c"># Flag for finding start string</span>
        <span class="n">endFound</span>   <span class="o">=</span> <span class="bp">False</span>  <span class="c"># Flag for finding end string</span>
        <span class="n">outLines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>   <span class="c"># Declare output list result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c"># Reset pointer for file</span>

        <span class="c"># Open file for edited content</span>
        <span class="n">editFileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfile</span> <span class="o">+</span> <span class="s">&quot;.deleted&quot;</span>
        <span class="n">newfobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">editFileName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="c"># Loop over all lines in file until start string found and end string found</span>
        <span class="k">for</span> <span class="n">oldline</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fobj</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">startFound</span><span class="p">:</span>
                <span class="n">newfobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">oldline</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">startFound</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">endFound</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">startFound</span> <span class="ow">and</span> <span class="n">endFound</span><span class="p">:</span>
                <span class="n">newfobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">oldline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Error with file line delete&quot;</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                
            <span class="c"># Set start/end flags</span>
            <span class="n">strline</span> <span class="o">=</span> <span class="n">oldline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">strline</span><span class="p">:</span>
                <span class="n">startFound</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">end</span> <span class="o">==</span> <span class="n">strline</span><span class="p">)</span> <span class="ow">and</span> <span class="n">startFound</span><span class="p">:</span>
                <span class="n">endFound</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c"># Close edited file</span>
        <span class="n">newfobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Created file &quot;</span><span class="p">,</span> <span class="n">editFileName</span></div></div>
</pre></div>

    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, Dr. Scott W. Sides, Dr. Travis Kemper, Dr. Ross Larsen, Dr. Peter Graf.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>